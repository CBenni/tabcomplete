$.widget("cbenni.tabcomplete",{options:{collection:[]},_create:function(){var c=["","",""];var a=-1;var b=this;this.element.bind("click focus",function(){b.tabtries=-1});var d=null;this.element.keydown(function(i){var g=i.keyCode||i.which;if(g==9){i.preventDefault();if(a==-1){$this=$(this);var h=$this.caret();if($this.is("input, select, textarea")){d=function(e){return(arguments.length?$this.val(e):$this.val())}}else{d=function(e){return(arguments.length?$this.text(e):$this.text())}}var k=d();var l=(/\w+$/.exec(k.substr(0,h))||{index:h}).index;var f=h+(/^\w+/.exec(k.substr(h))||[""])[0].length;c=[k.substring(0,l),k.substring(l,f),k.substring(f+1)]}var j=b.options.collection||[];if(typeof j==="object"){j=j.filter(function(e){return e.toLowerCase().indexOf(c[1].toLowerCase())==0})}else{if(typeof j=="function"){j=j(c[1])}}if(j.length>0){a+=i.shiftKey?-1:1;if(a>=j.length){a=0}if(a<0){a=j.length+a}d(c[0]+j[a]+c[2]);$(this).caret(c[0].length+j[a].length)}}else{if(g==27&&a>=0){d(c[0]+c[1]+c[2])}else{if(g!=16){a=-1}}}})}});