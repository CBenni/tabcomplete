$.widget("cbenni.tabcomplete",{options:{collection:[]},_create:function(){this.textsplit=["","",""];this.tabtries=-1;var a=this;this.element.bind("click focus",function(){a.tabtries=-1});this.element.keydown(function(b){return function(h){var f=h.keyCode||h.which;if(f==9){h.preventDefault();if(b.tabtries==-1){var g=$(this).caret();var j=$(this).val()||$(this).text();var k=(/\w+$/.exec(j.substr(0,g))||{index:g}).index;var d=c+(/^\w+/.exec(j.substr(g))||[""])[0].length;b.textsplit=[j.substring(0,k),j.substring(k,d),j.substring(d+1)]}var i=b.options.collection||[];if(typeof i==="object"){i=i.filter(function(e){return e.toLowerCase().indexOf(b.textsplit[1].toLowerCase())==0})}else{if(typeof i=="function"){i=i(b.textsplit[1])}}if(i.length>0){b.tabtries+=h.shiftKey?-1:1;if(b.tabtries>=i.length){b.tabtries=0}if(b.tabtries<0){b.tabtries=i.length+b.tabtries}$(this).val(b.textsplit[0]+i[b.tabtries]+b.textsplit[2]);$(this).text(b.textsplit[0]+i[b.tabtries]+b.textsplit[2]);$(this).caret(b.textsplit[0].length+i[b.tabtries].length)}}else{if(f==27&&b.tabtries>=0){$(this).val(b.textsplit[0]+b.textsplit[1]+b.textsplit[2]);$(this).text(b.textsplit[0]+b.textsplit[1]+b.textsplit[2])}else{if(f!=16){b.tabtries=-1}}}}}(this))}});