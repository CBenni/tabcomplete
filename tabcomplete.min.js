$.widget("cbenni.tabcomplete",{options:{collection:[]},_create:function(){this.textsplit=["","",""];this.tabtries=-1;var a=this;this.element.bind("click focus",function(){a.tabtries=-1});this.element.keydown(function(b){return function(g){var d=g.keyCode||g.which;if(d==9){g.preventDefault();if(b.tabtries==-1){var f=$(this).caret();var i=$(this).val()||$(this).text();var j=(/\w+$/.exec(i.substr(0,f))||{index:f}).index;var c=f+(/^\w+/.exec(i.substr(f))||[""])[0].length;b.textsplit=[i.substring(0,j),i.substring(j,c),i.substring(c+1)]}var h=b.options.collection||[];if(typeof h==="object"){h=h.filter(function(e){return e.toLowerCase().indexOf(b.textsplit[1].toLowerCase())==0})}else{if(typeof h=="function"){h=h(b.textsplit[1])}}if(h.length>0){b.tabtries+=g.shiftKey?-1:1;if(b.tabtries>=h.length){b.tabtries=0}if(b.tabtries<0){b.tabtries=h.length+b.tabtries}$(this).val(b.textsplit[0]+h[b.tabtries]+b.textsplit[2]);$(this).text(b.textsplit[0]+h[b.tabtries]+b.textsplit[2]);$(this).caret(b.textsplit[0].length+h[b.tabtries].length)}}else{if(d==27&&b.tabtries>=0){$(this).val(b.textsplit[0]+b.textsplit[1]+b.textsplit[2]);$(this).text(b.textsplit[0]+b.textsplit[1]+b.textsplit[2])}else{if(d!=16){b.tabtries=-1}}}}}(this))}});